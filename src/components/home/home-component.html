<template>
  <div class="row">
    <div class="col-12">

      <!--div class="row">
        <div ref="paramStats"></div>
      </div-->
      <div show.bind="filter.part==null">
        <H5>Analyse par pi&egrave;ce </H5>
        <!--   <H5 if.bind="config.totalItems>0">(${config.totalItems} r&eacute;sultats)</H5>  -->
      </div>
      <!--button type="button" class="btn btn-secondary" if.bind="false">Exporter les donn&eacute;es</button-->

      <div>

        <div style="font-size: 90%; width: 100%">
          <table class="table table-hover">
            <thead class="thead-dark">
            <tr>
              <th colspan="6" style="background-color: transparent; border:0px; padding:0px">
                <div show.bind="filter.part==null">
                  <nav aria-label="Page navigation example">
                    <ul class="pagination" style="margin-bottom:0px" if.bind="config.totalItems>0">
                      <li class="page-item">
                        <a class="page-link" href="#" click.trigger="setPage(-1)">Pr&eacute;c.</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="#" if.bind="currentPage>1" click.trigger="setPage(-1)">${currentPage-1}</a>
                      </li>
                      <li class="page-item disabled">
                        <a class="page-link">${currentPage}</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="#" click.trigger="setPage(1)">${currentPage + 1}</a>
                      </li>
                      <li class="page-item">
                        <a class="page-link" href="#" click.trigger="setPage(1)">Suiv.</a>
                      </li>
                    </ul>
                  </nav>
                </div>
              </th>
              <th colspan="4" style="background-color: #008094; border:0px" if.bind="currentView!='Qualité'">Manque à gagner crédible</th>
              <th colspan="4" style="background-color: #786F64; border:0px" if.bind="currentView!='Qualité'">Manque à gagner théorique</th>
              <th colspan="2" style="background-color: #008094; border:0px" if.bind="currentView=='Qualité'">ORI</th>
              <th colspan="2" style="background-color: #786F64; border:0px" if.bind="currentView=='Qualité'">ORF</th>
              <th colspan="2" style="background-color: #BE3D00; border:0px" if.bind="currentView=='Qualité'">PQE</th>
            </tr>
            <tr>
              <th scope="col">R&eacute;f. Fabriquant</th>
              <th scope="col">R&eacute;f. Kapp</th>
              <th scope="col">Libell&eacute;</th>
              <th scope="col">Quantit&eacute; achet&eacute;e</th>
              <th scope="col">Prix d'achat moyen (€)</th>
              <th scope="col"><a href="#" click.trigger="setSortField('SomMontantCalc')" class="au-target table-sort">Dépenses totales (€)</a><span if.bind="sortField=='SomMontantCalc'" class="oi oi-caret-bottom"></span></th>
              <th scope="col" if.bind="currentView!='Qualité'" style="border-left: 1px solid #124162">
                <div class="hoverable">
                  Achats optimisés (%)
                  <div class="hoverText">Les <i>achats optimisés</i> associés au prix crédible représentent le pourcentage de pièces achetées au prix crédible dans la période sélectionnée.</div>
                </div>
              </th>
              <th scope="col" if.bind="currentView!='Qualité'"><div class="">
                <div class="hoverable">
                  Prix crédible moyen (€)
                  <div class="hoverText">Le <i>prix crédible</i> correspond au prix minimum observable le jour de la commande, pour une référence pièce fournisseur donnée, représentant au moins <b>10% des achats au niveau du Groupe</b>. Ce prix crédible est calculé sur une période de 12 moins précédent la date de commande.<br />Le <i>prix crédible moyen</i> représente la moyenne du prix crédible sur la période sélectionnée.</div>
                </div>
              </th>
              <th scope="col" if.bind="currentView!='Qualité'"><a href="#" click.trigger="setSortField('MAGPMC')" class="au-target table-sort">
                <div class="hoverable">
                  Manque &agrave; Gagner cr&eacute;dible (€)
                  <div class="hoverText">Le <i>Manque à Gagner crédible</i> (ou MAG crédible) représente la différence (en €) entre le prix payé et le prix crédible, sur l'ensemble des commandes.</div>
                </div>
              </a><span if.bind="sortField=='MAGPMC'" class="oi oi-caret-bottom"></span></th>
              <th scope="col" if.bind="currentView!='Qualité'">
                <div class="hoverable">
                  Cumul des Manques à Gagner crédible(%)
                  <div class="hoverText">Le <i>cumul des Manque à Gagner crédible</i> représente le pourcentage de Manque à Gagner cumulé ligne par ligne par rapport au Manque à Gagner total de la/les filiale(s) sélectionnée(s) sur la période sélectionnée.<br /><br /><i>Exemple : si le cumul des Manque à Gagner crédible est de X% à la ligne N, cela signifie que l'ensemble des pièces des lignes 1 à N représente X% de Manque à Gagner crédible par rapport au Manque à Gagner total.</i></div>
                </div>
              </th>
              <th scope="col" if.bind="currentView!='Qualité'" style="border-left: 1px solid #124162">
                <div class="hoverable">
                  Achats optimisés (%)
                  <div class="hoverText">Les <i>achats optimisés</i> associés au prix minimum représentent le pourcentage de pièces achetées au prix minimum dans la période sélectionnée.</div>
                </div>
              </th>
              <th scope="col" if.bind="currentView!='Qualité'">
                <div class="hoverable">
                  Prix minimum moyen (€)
                  <div class="hoverText">Le <i>prix minimum</i> correspond au prix minimum observable sur l’ensemble des prix au catalogue le jour de la commande de la pièce.<br />Le <i>prix minimum moyen</i> représente naturellement la moyenne du prix minimum sur la période sélectionnée.</div>
                </div>
              </th>
              <th scope="col" if.bind="currentView!='Qualité'"><a href="#" click.trigger="setSortField('MAGPMT')" class="au-target table-sort">
                <div class="hoverable">
                  Manque &agrave; Gagner th&eacute;orique (€)
                  <div class="hoverText" style="margin-left:-180px">Le <i>Manque à Gagner théorique</i> (ou MAG théorique) représente la différence (en €) entre le prix payé et le prix minimum, sur l'ensemble des commandes.</div>
                </div>
              </a><span if.bind="sortField=='MAGPMT'" class="oi oi-caret-bottom"></span></th>
              <th scope="col" if.bind="currentView!='Qualité'">
                <div class="hoverable">
                  Cumul des Manques à Gagner théorique (%)
                  <div class="hoverText" style="margin-left:-230px">Le <i>cumul des Manque à Gagner théorique</i> représente le pourcentage du Manque à Gagner théorique ligne par ligne par rapport au Manque à Gagner total de la/les filiale(s) sélectionnée(s) sur la période sélectionnée.<br /><br /><i>Exemple : si le cumul des Manque à Gagner théorique est de X% à la ligne N, cela signifie que l'ensemble des pièces des lignes 1 à N représente X% de Manque à Gagner théorique par rapport au Manque à Gagner total.</i></div>
                </div>
              </th>

              <th scope="col" if.bind="currentView=='Qualité'" style="border-left: 1px solid #124162">ORI <br />Quantité commandée</th>
              <th scope="col" if.bind="currentView=='Qualité'">ORI <br />Prix d'achat moyen (€)</th>
              <th scope="col" if.bind="currentView=='Qualité'" style="border-left: 1px solid #124162">ORF <br />Quantité commandée</th>
              <th scope="col" if.bind="currentView=='Qualité'">ORF <br />Prix d'achat moyen (€)</th>
              <th scope="col" if.bind="currentView=='Qualité'" style="border-left: 1px solid #124162">PQE <br />Quantité commandée</th>
              <th scope="col" if.bind="currentView=='Qualité'">PQE <br />Prix d'achat moyen (€)</th>
            </tr>
            </thead>
            <tbody class="table">
            <tr show.bind="!achatsStatsReady && currentView!='Qualité'">
              <td>
                <img src="../../../static/throbber.gif"/>
              </td>
            </tr>
            <tr show.bind="!achatsQualiteStatsReady.length==0 && currentView=='Qualité'">
              <td>
                <img src="../../../static/throbber.gif"/>
              </td>
            </tr>
            <tr repeat.for="achat of achatsStats"  if.bind="currentView!='Qualité' || achat.showQuality ">
              <td scope="col">${achat["main.LignesCommande.RefFabricant"]}</td>
              <td scope="col">${achat["main.LignesCommande.Article"]}</td>
              <td scope="col" ><p title.bind="partNames[achat['main.LignesCommande.RefFabricant']]">${partNames[achat["main.LignesCommande.RefFabricant"]].substring(0,15)}</p></td>
              <td scope="col">${achat["SomQuantiteFacturee"]}</td>
              <td scope="col">${ achat["SomMontantCalc"]  / achat["SomQuantiteFacturee"] | numberFormat:'0.0)'}</td>
              <th scope="col"  >${achat["SomMontantCalc"] | numberFormat:'(0)'}</th>
              <td scope="col" if.bind="currentView!='Qualité'" class="table-warning">${(1 - achat["totalPMCOptiVol"] / achat["SomQuantiteFacturee"] )* 100 | numberFormat:'0)'}%</td>
              <td scope="col" if.bind="currentView!='Qualité'" class="table-warning">${achat["PMC"] | numberFormat:'0.0)'}</td>
              <td scope="col" if.bind="currentView!='Qualité'" class="table-warning">${achat["MAGPMC"] | numberFormat:'0.0)'}</td>
              <td scope="col" if.bind="currentView!='Qualité'" class="table-warning">${achat["MAGPMCCUMUL"] | numberFormat:'(0.0 %)'}</td>
              <td scope="col" if.bind="currentView!='Qualité'" class="table-danger"> ${(1 - achat["totalPMTOptiVol"] / achat["SomQuantiteFacturee"])* 100 | numberFormat:'0)'}%</td>
              <td scope="col" if.bind="currentView!='Qualité'" class="table-danger">${achat["PMT"] | numberFormat:'0.0)'}</td>
              <td scope="col" if.bind="currentView!='Qualité'" class="table-danger">${achat["MAGPMT"] | numberFormat:'0.0)'}</td>
              <td scope="col" if.bind="currentView!='Qualité'" class="table-danger">${achat["MAGPMTCUMUL"] | numberFormat:'(0.0 %)'}</td>

              <td scope="col" if.bind="currentView=='Agrégée'">
                <a href="#" click.trigger="setCurrentPart(achat['main.LignesCommande.RefFabricant'], partNames[achat['main.LignesCommande.RefFabricant']], achat)"
                   filter.bind="filter" class="badge badge-danger">D&eacute;tails</a>
              </td>

              <th scope="col" if.bind="currentView=='Qualité'" class="table-warning">${achatsQualiteStats[achat["main.LignesCommande.RefFabricant"]][achat["main.LignesCommande.Article"]]["ORI"]["SomQuantiteFacturee"] /achat["SomQuantiteFacturee"] | numberFormat:'(0.0 %)'}</th>
              <th scope="col" if.bind="currentView=='Qualité'" class="table-warning">${achatsQualiteStats[achat["main.LignesCommande.RefFabricant"]][achat["main.LignesCommande.Article"]]["ORI"]["AvgPrixTarif"]| numberFormat:'(0.0)'}</th>
              <th scope="col" if.bind="currentView=='Qualité'" class="table-danger">${achatsQualiteStats[achat["main.LignesCommande.RefFabricant"]][achat["main.LignesCommande.Article"]]["ORF"]["SomQuantiteFacturee"] /achat["SomQuantiteFacturee"]| numberFormat:'(0.0 % )'}</th>
              <th scope="col" if.bind="currentView=='Qualité'" class="table-danger">${achatsQualiteStats[achat["main.LignesCommande.RefFabricant"]][achat["main.LignesCommande.Article"]]["ORF"]["AvgPrixTarif"]| numberFormat:'(0.0)'}</th>
              <th scope="col" if.bind="currentView=='Qualité'" class="table-info">${achatsQualiteStats[achat["main.LignesCommande.RefFabricant"]][achat["main.LignesCommande.Article"]]["PQE"]["SomQuantiteFacturee"]/ achat["SomQuantiteFacturee"] | numberFormat:'(0.0 %)'}</th>
              <th scope="col" if.bind="currentView=='Qualité'" class="table-info">${achatsQualiteStats[achat["main.LignesCommande.RefFabricant"]][achat["main.LignesCommande.Article"]]["PQE"]["AvgPrixTarif"] | numberFormat:'(0.0)'}</th>


            </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
</template>
